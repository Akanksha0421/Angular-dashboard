<div class="details-root">
	<app-navbar (menuClick)="onMenuClick()"></app-navbar>
	<button class="back-to-landing" (click)="goBack()">← Back</button>
	<div class="details-main-flex">
		<div class="sidebar-flex" [class.sidebar-open]="sidebarOpen">
			<app-sidebar
				*ngIf="sidebarOpen"
				[stacks]="stacks"
				[selectedStackId]="selectedStackId"
				[expanded]="sidebarOpen"
				(stackSelect)="onStackSelect($event)"
				(back)="onSidebarBack()"
			></app-sidebar>
		</div>
		<div class="details-content" [class.shrunk]="sidebarOpen">
			<!-- Stack Header -->
			<div class="stack-header" *ngIf="selectedStack">
				<div class="stack-title-row">
					<span class="stack-warning">&#9888;</span>
					<span class="stack-title">{{ selectedStack.name }}</span>
					<span class="stack-id">Stack id: <b>{{ selectedStack.id }}</b></span>
						<span class="stack-forecast-group">
							<span class="forecast-label-block">
								<span class="forecast-label-title">FORECAST VALUE</span>
								<span class="forecast-label-value">${{ selectedStack.forecastValue || '--' }}</span>
							</span>
							<span class="forecast-label-block">
								<span class="forecast-label-title">FORECAST %</span>
								<span class="forecast-label-value">{{ selectedStack.forecastPercent ? (selectedStack.forecastPercent | number:'1.1-1') + '%' : '--' }}</span>
							</span>
							<span class="forecast-label-block">
								<span class="forecast-label-title">F'CAST STAB.</span>
								<span class="forecast-label-value">{{ selectedStack.forecastStab || '--' }}</span>
							</span>
							<span class="forecast-label-block">
								<span class="forecast-label-title">F'CAST ACC.</span>
								<span class="forecast-label-value">{{ selectedStack.forecastAcc || '--' }}</span>
							</span>
						</span>
				</div>
			</div>
			<!-- Special Requirements Section -->
			<div class="special-req-section">
				<span class="special-req-label">SPECIAL REQUIREMENTS</span>
				<label class="switch">
					<input type="checkbox" />
					<span class="slider round"></span>
				</label>
				<span class="special-req-include">INCLUDE</span>
				<span class="special-req-dropdown">&#9660;</span>
			</div>
			<!-- Combined Chart Section -->
			<div class="combined-chart-row">
				<canvas baseChart
					[data]="chartData"
					[options]="chartOptions"
					[type]="chartType"
					height="420">
				</canvas>
			</div>
			<!-- Collapsible Data Sections -->
			<div class="data-section">
				<div class="data-row" *ngFor="let data of ['Data 1', 'Data 2', 'Data 3']; let i = index">
					<div class="data-row-header" (click)="dataExpanded[i] = !dataExpanded[i]">
						<span>{{ data }}</span>
						<span class="expand-icon">{{ dataExpanded[i] ? '▼' : '►' }}</span>
					</div>
					<div class="data-row-content" *ngIf="dataExpanded[i]">
						<table class="data-table">
							<thead>
								<tr>
									<th></th>
									<th *ngFor="let label of chartData.labels">{{ label }}</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let row of tableData">
									<td>{{ row.label }}</td>
									<td *ngFor="let val of row.values">{{ val }}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
